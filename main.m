
clc;clear;
global vehicle; 
global center_position;
vehicle = [105 ;140];
center_position = [108.969337,34.276048]';


inn = 30; % 初始种群大小
gnMax = 50;  % 最大代数
crossProb = 0.8; % 交叉概率
muteProb = 0.2; % 变异概率
unit_cost = 2.1;% 单位费率 


all_info = load('all_info_data');
city_info = load('tsp_data');
all_info_data = all_info.all_info_data;

% 车辆分配
[demend_vehicle,] = vehicle_distribution(all_info_data);

while demend_vehicle
% 线路规划-------
[cur_info, all_info_data] = route_devided(all_info_data); % TODO 1、对于对车量情况的分析
% 这个函数将线路根据车容量限制，划分成多条路线，将返回一条路线的信息
center_info_one_row = [center_position' 0 0];
cur_info = [cur_info;center_info_one_row];
save('tsp_data','cur_info');
save('all_info_data','all_info_data');
length = size(cur_info,1);
% 路径优化-------
GaTSP(length, inn, gnMax, crossProb, muteProb, unit_cost);
% 这函数将tsp路线进行优化
demend_vehicle = demend_vehicle - 1;
end